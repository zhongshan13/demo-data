{%- comment -%}
------------------------------------------------------------------------------
Section: Gallery
------------------------------------------------------------------------------
{%- endcomment -%}

{% case settings.design %}
	{% when 'alternate' %}
		{% render 'gallery-new', section: section %}
	{% when 'standard' %}
		{{- "gallery.build.css" | asset_url | stylesheet_tag -}}

		{%- style -%}
			#shopify-section-{{- section.id -}} {
				padding-top: {{- section.settings.offset_top_mobile -}}px;
				padding-bottom: {{- section.settings.offset_bottom_mobile -}}px;
			}

			@media screen and (min-width: 768px) {
				#shopify-section-{{- section.id -}} {
					padding-top: {{- section.settings.offset_top_desktop -}}px;
					padding-bottom: {{- section.settings.offset_bottom_desktop -}}px;
				}
			}
		{%- endstyle -%}

		{%- assign image_aspect_ratio = section.settings.image_aspect_ratio -%}
		{%- assign image_crop 	      = section.settings.image_crop -%}
		{%- assign overlay_opacity    = section.settings.overlay_opacity | divided_by: 100.0 -%}
		{%- assign overlay_color      = section.settings.overlay_color -%}
		{%- assign full_width 	      = section.settings.full_width -%}
		{%- assign blocks 		      = section.blocks -%}

		{%- assign portrait_coefficient = 0.666 -%} {% comment %} 1:1.5 {% endcomment %}

		{%- capture styles -%}
			--img-overlay-opacity: {{ overlay_opacity }}; {{-  -}}
			--img-overlay-color: {{ overlay_color }}; {{-  -}}
			--img-wrapper-padding-top: calc(100%/{{ portrait_coefficient }}); {{-  -}}
		{%- endcapture -%}

		<section class="gallery {% if full_width == false %}gallery--max-width{% endif %} js-animate {% if request.visual_preview_mode or section.index == 1 %}animated{% endif %} gallery--{{- image_aspect_ratio -}}" style="{{- styles -}}">
			{%- if blocks.size > 0 -%}
				{%- for block in blocks -%}
					{%- assign image 			= block.settings.image -%}
					{%- assign video 			= block.settings.video -%}

					{% if video != blank %}
						{% assign image = video.preview_image %}
					{% endif %}

					{%- assign icon_hover 		= block.settings.icon_hover -%}
					{%- assign url 				= block.settings.url -%}
					{%- assign open_in_new_tab 	= block.settings.open_in_new_tab -%}

					{% assign is_lazy = true %}

					{% if section.index == 1 %}
						{% assign is_lazy = false %}
					{% endif %}

					{%- if image != blank -%}
						{%- capture img_focal -%}
							--img-desktop-pos: {{ image.presentation.focal_point }};
						{%- endcapture -%}

						<div class="gallery__col">
							{%- if url != blank -%}
								<a
									class="gallery__link {% if video != blank %}js-gallery-video-container{% endif %}"
									href="{{- url -}}"
									{% if open_in_new_tab %}
										target="_blank"
									{% endif %}
									aria-label="{{ image.alt | escape }}"
								>
							{%- endif -%}

							<span class="gallery__col-content">
	                            <span class="gallery__image-wrapper {% if video != blank and url == blank %}js-gallery-video-container{% endif %}">
									{% if video != blank %}
										<video
											class="gallery__video js-gallery-video"
											muted
											loop
											playsinline
										>
											{%- for source in video.sources -%}
												{%- if source.mime_type == 'video/mp4' -%}
													<source src="{{- source.url -}}" type="{{- source.mime_type -}}">
												{%- endif -%}
											{%- endfor -%}
										</video>
									{% endif %}

	                                <picture {% if is_lazy %}class="lazy"{% endif %}>
		                                {%- liquid
			                                assign width_default = 336
			                                assign width_small = 165
			                                assign width_extra_small = 256
			                                assign width_small_tablet_portrait = 192
			                                assign width_mobile_landscape = 240
			                                assign width_mobile = 187

			                                assign height_default = width_default
			                                assign height_small = width_small
			                                assign height_extra_small = width_extra_small
			                                assign height_small_tablet_portrait = width_small_tablet_portrait
			                                assign height_mobile_landscape = width_mobile_landscape
			                                assign height_mobile = width_mobile

			                                if image_aspect_ratio == 'portrait'
				                                assign height_default = height_default | divided_by: portrait_coefficient | ceil
				                                assign height_small = height_small | divided_by: portrait_coefficient | ceil
				                                assign height_extra_small = height_extra_small | divided_by: portrait_coefficient | ceil
				                                assign height_small_tablet_portrait = height_small_tablet_portrait | divided_by: portrait_coefficient | ceil
				                                assign height_mobile_landscape = height_mobile_landscape | divided_by: portrait_coefficient | ceil
				                                assign height_mobile = height_mobile | divided_by: portrait_coefficient | ceil
			                                endif

			                                assign width_default_x2 = width_default | times: 2
			                                assign width_small_x2 = width_small | times: 2
			                                assign width_extra_small_x2 = width_extra_small | times: 2
			                                assign width_small_tablet_portrait_x2 = width_small_tablet_portrait | times: 2
			                                assign width_mobile_landscape_x2 = width_mobile_landscape | times: 2
			                                assign width_mobile_x2 = width_mobile | times: 2

			                                assign height_default_x2 = height_default | times: 2
			                                assign height_small_x2 = height_small | times: 2
			                                assign height_extra_small_x2 = height_extra_small | times: 2
			                                assign height_small_tablet_portrait_x2 = height_small_tablet_portrait | times: 2
			                                assign height_mobile_landscape_x2 = height_mobile_landscape | times: 2
			                                assign height_mobile_x2 = height_mobile | times: 2
		                                -%}

		                                {% if is_lazy %}
			                                <source
				                                data-srcset="{{ image | image_url: width: width_mobile, height: height_mobile, crop: image_crop }} 1x, {{ image | image_url: width: width_mobile_x2, height: height_mobile_x2, crop: image_crop }} 2x"
				                                srcset="{{ image | image_url: width: 10 }} 1x, {{ image | image_url: width: 20 }} 2x"
				                                media="(max-width: 380px)"
				                                width="{{ width_mobile }}"
				                                height="{{ height_mobile }}"
			                                />

			                                <source
				                                data-srcset="{{ image | image_url: width: width_mobile_landscape, height: height_mobile_landscape, crop: image_crop }} 1x, {{ image | image_url: width: width_mobile_landscape_x2, height: height_mobile_landscape_x2, crop: image_crop }} 2x"
				                                srcset="{{ image | image_url: width: 10 }} 1x, {{ image | image_url: width: 20 }} 2x"
				                                media="(max-width: 480px)"
				                                width="{{ width_mobile_landscape }}"
				                                height="{{ height_mobile_landscape }}"
			                                />

			                                <source
				                                data-srcset="{{ image | image_url: width: width_small_tablet_portrait, height: height_small_tablet_portrait, crop: image_crop }} 1x, {{ image | image_url: width: width_small_tablet_portrait_x2, height: height_small_tablet_portrait_x2, crop: image_crop }} 2x"
				                                srcset="{{ image | image_url: width: 10 }} 1x, {{ image | image_url: width: 20 }} 2x"
				                                media="(max-width: 575px)"
				                                width="{{ width_small_tablet_portrait }}"
				                                height="{{ height_small_tablet_portrait }}" />

			                                <source
				                                data-srcset="{{ image | image_url: width: width_extra_small, height: height_extra_small, crop: image_crop }} 1x, {{ image | image_url: width: width_extra_small_x2, height: height_extra_small_x2, crop: image_crop }} 2x"
				                                srcset="{{ image | image_url: width: 10 }} 1x, {{ image | image_url: width: 20 }} 2x"
				                                media="(max-width: 767px)"
				                                width="{{ width_extra_small }}"
				                                height="{{ height_extra_small }}" />

			                                <source
				                                data-srcset="{{ image | image_url: width: width_small, height: height_small, crop: image_crop }} 1x, {{ image | image_url: width: width_small_x2, height: height_small_x2, crop: image_crop }} 2x"
				                                srcset="{{ image | image_url: width: 10 }} 1x, {{ image | image_url: width: 20 }} 2x"
				                                media="(max-width: 991px)"
				                                width="{{ width_small }}"
				                                height="{{ height_small }}" />

			                                <img
				                                data-srcset="{{ image | image_url: width: width_default, height: height_default, crop: image_crop }} 1x, {{ image | image_url: width: width_default_x2, height: height_default_x2, crop: image_crop }} 2x"
				                                data-src="{{- image | image_url: width: width_default, height: height_default, crop: image_crop -}}"
				                                srcset="{{ image | image_url: width: 10 }} 1x, {{ image | image_url: width: 20 }} 2x"
				                                src="{{ image | image_url: width: 10 }}"
				                                class="gallery__image"
				                                alt="{%- if url == blank -%}{{- image.alt -}}{%- endif -%}"
				                                width="{{ width_default }}"
				                                height="{{ height_default }}"
				                                style="{{ img_focal }}"
			                                />
		                                {% else %}
			                                <source
				                                srcset="{{ image | image_url: width: width_mobile, height: height_mobile, crop: image_crop }} 1x, {{ image | image_url: width: width_mobile_x2, height: height_mobile_x2, crop: image_crop }} 2x"
				                                media="(max-width: 380px)"
				                                width="{{ width_mobile }}"
				                                height="{{ height_mobile }}"
			                                />

			                                <source
				                                srcset="{{ image | image_url: width: width_mobile_landscape, height: height_mobile_landscape, crop: image_crop }} 1x, {{ image | image_url: width: width_mobile_landscape_x2, height: height_mobile_landscape_x2, crop: image_crop }} 2x"
				                                media="(max-width: 480px)"
				                                width="{{ width_mobile_landscape }}"
				                                height="{{ height_mobile_landscape }}"
			                                />

			                                <source
				                                srcset="{{ image | image_url: width: width_small_tablet_portrait, height: height_small_tablet_portrait, crop: image_crop }} 1x, {{ image | image_url: width: width_small_tablet_portrait_x2, height: height_small_tablet_portrait_x2, crop: image_crop }} 2x"
				                                media="(max-width: 575px)"
				                                width="{{ width_small_tablet_portrait }}"
				                                height="{{ height_small_tablet_portrait }}" />

			                                <source
				                                srcset="{{ image | image_url: width: width_extra_small, height: height_extra_small, crop: image_crop }} 1x, {{ image | image_url: width: width_extra_small_x2, height: height_extra_small_x2, crop: image_crop }} 2x"
				                                media="(max-width: 767px)"
				                                width="{{ width_extra_small }}"
				                                height="{{ height_extra_small }}" />

			                                <source
				                                srcset="{{ image | image_url: width: width_small, height: height_small, crop: image_crop }} 1x, {{ image | image_url: width: width_small_x2, height: height_small_x2, crop: image_crop }} 2x"
				                                media="(max-width: 991px)"
				                                width="{{ width_small }}"
				                                height="{{ height_small }}" />

			                                <img
				                                srcset="{{ image | image_url: width: width_default, height: height_default, crop: image_crop }} 1x, {{ image | image_url: width: width_default_x2, height: height_default_x2, crop: image_crop }} 2x"
				                                src="{{- image | image_url: width: width_default, height: height_default, crop: image_crop -}}"
				                                class="gallery__image"
				                                alt="{%- if url == blank -%}{{- image.alt -}}{%- endif -%}"
				                                width="{{ width_default }}"
				                                height="{{ height_default }}"
				                                style="{{ img_focal }}"
			                                />
		                                {% endif %}
	                                </picture>

	                                <noscript>
	                                    <picture>
	                                        <source
		                                        srcset="{{ image | image_url: width: width_mobile, height: height_mobile, crop: image_crop }} 1x, {{ image | image_url: width: width_mobile_x2, height: height_mobile_x2, crop: image_crop }} 2x"
		                                        media="(max-width: 380px)"
		                                        width="{{ width_mobile }}"
		                                        height="{{ height_mobile }}"
	                                        />

											<source
												srcset="{{ image | image_url: width: width_mobile_landscape, height: height_mobile_landscape, crop: image_crop }} 1x, {{ image | image_url: width: width_mobile_landscape_x2, height: height_mobile_landscape_x2, crop: image_crop }} 2x"
												media="(max-width: 480px)"
												width="{{ width_mobile_landscape }}"
												height="{{ height_mobile_landscape }}"
											/>

											<source
												srcset="{{ image | image_url: width: width_small_tablet_portrait, height: height_small_tablet_portrait, crop: image_crop }} 1x, {{ image | image_url: width: width_small_tablet_portrait_x2, height: height_small_tablet_portrait_x2, crop: image_crop }} 2x"
												media="(max-width: 575px)"
												width="{{ width_small_tablet_portrait }}"
												height="{{ height_small_tablet_portrait }}" />

											<source
												srcset="{{ image | image_url: width: width_extra_small, height: height_extra_small, crop: image_crop }} 1x, {{ image | image_url: width: width_extra_small_x2, height: height_extra_small_x2, crop: image_crop }} 2x"
												media="(max-width: 767px)"
												width="{{ width_extra_small }}"
												height="{{ height_extra_small }}" />

											<source
												srcset="{{ image | image_url: width: width_small, height: height_small, crop: image_crop }} 1x, {{ image | image_url: width: width_small_x2, height: height_small_x2, crop: image_crop }} 2x"
												media="(max-width: 991px)"
												width="{{ width_small }}"
												height="{{ height_small }}" />

											<img
												srcset="{{ image | image_url: width: width_default, height: height_default, crop: image_crop }} 1x, {{ image | image_url: width: width_default_x2, height: height_default_x2, crop: image_crop }} 2x"
												src="{{- image | image_url: width: width_default, height: height_default, crop: image_crop -}}"
												class="gallery__image"
												alt="{%- if url == blank -%}{{- image.alt -}}{%- endif -%}"
												width="{{ width_default }}"
												height="{{ height_default }}"
												style="{{ img_focal }}"
											/>
	                                    </picture>
	                                </noscript>
	                            </span>

	                            <span class="gallery__overlay">
									{% if icon_hover != blank %}
										<span class="gallery__icon" aria-hidden="true">
											<img class="gallery__icon-img"
											     src="{{ icon_hover | image_url: width: 50, height: 50 }}"
											     srcset="{{ icon_hover | image_url: width: 25, height: 25 }} 1x, {{ icon_hover | image_url: width: 50, height: 50 }} 2x"
											     alt=""
											     style="object-position: {{ icon_hover.presentation.focal_point }};"
											     aria-hidden="true"
											>
										</span>
									{% endif %}
	                            </span>
	                        </span>

							{%- if url != blank -%}
								</a>
							{%- endif -%}
						</div>
					{%- endif -%}
				{%- endfor -%}
			{%- else -%}
				{%- for i in (1..6) -%}
					<div class="gallery__col">
						{{- "image" | placeholder_svg_tag -}}
					</div>
				{%- endfor -%}
			{%- endif -%}
		</section>
{% endcase %}

<script src="{{- 'section-gallery.build.min.js' | asset_url -}}" defer></script>

{%- schema -%}
    {
        "name": "Image gallery",
        "disabled_on": {
            "groups": ["header", "footer"]
        },
        "settings": [
	        {
		        "type": "select",
		        "id": "image_aspect_ratio",
		        "label": "Image aspect ratio",
		        "options": [
			        {
				        "value": "square",
				        "label": "Square"
			        },
			        {
				        "value": "portrait",
				        "label": "Portrait"
			        }
		        ],
		        "default": "square"
	        },
	        {
		        "type": "select",
		        "id": "image_crop",
		        "label": "Image crop",
		        "info": "The setting allows you to specify which part of the image to show if the specified dimensions result in an aspect ratio that differs from the original.",
		        "options": [
			        {
				        "value": "top",
				        "label": "Top"
			        },
			        {
				        "value": "center",
				        "label": "Center"
			        },
			        {
				        "value": "bottom",
				        "label": "Bottom"
			        }
		        ],
		        "default": "center"
	        },
			{
				"id": "overlay_opacity",
				"type": "range",
				"label": "Overlay opacity",
				"min": 0,
				"max": 100,
				"unit": "%",
				"default": 50
			},
            {
              "type": "color",
              "id": "overlay_color",
              "label": "Overlay color",
              "default": "#000000"
            },
            {
                "type": "header",
                "content": "Layout"
            },
			{
				"type": "checkbox",
				"id": "full_width",
				"label": "Make full width",
				"default": true,
				"info": "If unchecked - container width will be set based on the group 'Layout' settings in the Theme settings."
			},
            {
                "type": "range",
                "id": "offset_top_desktop",
                "min": 0,
                "max": 100,
                "step": 1,
                "unit": "px",
                "label": "Desktop offset top",
                "default": 0
            },
            {
                "type": "range",
                "id": "offset_bottom_desktop",
                "min": 0,
                "max": 100,
                "step": 1,
                "unit": "px",
                "label": "Desktop offset bottom",
                "default": 0
            },
            {
                "type": "range",
                "id": "offset_top_mobile",
                "min": 0,
                "max": 100,
                "step": 1,
                "unit": "px",
                "label": "Mobile offset top",
                "default": 0
            }, {
                "type": "range",
                "id": "offset_bottom_mobile",
                "min": 0,
                "max": 100,
                "step": 1,
                "unit": "px",
                "label": "Mobile offset bottom",
                "default": 0
            }
        ],
        "blocks": [
            {
                "type": "block",
                "name": "Image",
                "limit": 6,
                "settings": [
                    {
                        "type": "image_picker",
                        "id": "image",
                        "label": "Image",
	                    "info": "672 x 672px recommended"
                    },
					{
						"type": "video",
						"id": "video",
						"label": "Video",
						"info": "Video will start on hover (only on the desktop). Has priority over the image. Video preview image will be used on mobile resolution. 672 x 672px recommended"
					},
					{
						"type": "image_picker",
						"id": "icon_hover",
						"label": "Icon hover",
						"info": "25 x 25px .svg recommended"
					},
					{
                        "type": "url",
                        "id": "url",
                        "label": "Link"
                    },
					{
						"type": "checkbox",
						"id": "open_in_new_tab",
						"label": "Open link in new tab",
						"default": false
					}
                ]
            }
        ],
        "presets": [
            {
                "name": "Image gallery"
            }
        ]
    }
{%- endschema -%}
