{%- comment -%}
------------------------------------------------------------------------------
	Section: Products bundle
------------------------------------------------------------------------------
{%- endcomment -%}

{%- style -%}
	#shopify-section-{{- section.id -}} {
		padding-top: {{- section.settings.offset_top_mobile -}}px;
		padding-bottom: {{- section.settings.offset_bottom_mobile -}}px;
	}

	@media screen and (min-width: 768px) {
		#shopify-section-{{- section.id -}} {
			padding-top: {{- section.settings.offset_top_desktop -}}px;
			padding-bottom: {{- section.settings.offset_bottom_desktop -}}px;
		}
	}
{%- endstyle -%}

{%- assign default_button_text 		= 'products.label' | t -%}
{%- assign label 					= section.settings.label -%}
{%- assign heading 					= section.settings.heading -%}
{%- assign subheading 				= section.settings.subheading -%}
{%- assign product_list 			= section.settings.product_list -%}
{%- assign button_label 			= section.settings.button_label | default: default_button_text -%}
{%- assign button_disabled_label 	= section.settings.button_disabled_label | default: button_label -%}
{%- assign full_width 				= section.settings.full_width -%}
{%- assign button_type 				= section.settings.button_type -%}
{%- assign show_total 				= section.settings.show_total -%}
{%- assign border_color 			= section.settings.border_color | default: "transparent" -%}
{%- assign checkbox_color 			= section.settings.checkbox_color | default: "#000000" -%}
{%- assign design 					= settings.design -%}

{%- capture style -%}
	--border-color: {{- border_color -}}; {{-  -}}
	--checkbox-color: {{- checkbox_color -}};
{%- endcapture -%}

{%- assign all_products_has_available_variant = true -%}
{%- for product in product_list -%}
	{%- unless product.selected_or_first_available_variant.available -%}
		{%- assign all_products_has_available_variant = false -%}
		{%- break -%}
	{%- endunless -%}
{%- endfor -%}

{%- assign all_products_has_only_one_variant = true -%}
{%- for product in product_list -%}
	{%- unless product.has_only_default_variant -%}
		{%- assign all_products_has_only_one_variant = false -%}
		{%- break -%}
	{%- endunless -%}
{%- endfor -%}

{%- if product_list == blank -%}
	{%- assign all_products_has_available_variant = false -%}
	{%- assign all_products_has_only_one_variant = false -%}
{%- endif -%}

{%- capture old_layout -%}
	{{- 'products-bundle.build.css' | asset_url | stylesheet_tag -}}

	<section class="products-bundle js-products-bundle" style="{{- style -}}" data-section="{{- section.id -}}">
		<div class="products-bundle__container {% if full_width %}products-bundle__container--full-width{% endif %}">
			{%- if label != blank -%}
				<div class="products-bundle__label">
					{{- label -}}
				</div>
			{%- endif -%}

			{%- if heading != blank -%}
				<h2 class="products-bundle__heading">
					{{- heading -}}
				</h2>
			{%- endif -%}

			{%- if subheading != blank -%}
				<div class="products-bundle__subheading section-rte">
					{{- subheading -}}
				</div>
			{%- endif -%}

			<div class="products-bundle__content">
				<div class="products-bundle__row">
					{%- if product_list != blank -%}
						{%- for product in product_list -%}
							{%- assign sault = section.id | append: "-" | append: forloop.index -%}

							<div class="products-bundle__col">
								{%- render
									'product-card-with-form',
									product: product,
									size: 900,
									mobile_size: 400,
									sault: sault,
									hide_buttons: true,
									section_id: section.id
								-%}
							</div>
						{%- endfor -%}
					{%- else -%}
						{%- for i in (1..3) -%}
							{%- assign sault = section.id | append: "-" | append: forloop.index -%}

							<div class="products-bundle__col">
								{%- render
									'product-card-with-form',
									sault: sault,
									hide_buttons: true,
									section_id: section.id
								-%}
							</div>
						{%- endfor -%}
					{%- endif -%}
				</div>

				<div class="products-bundle__button-wrapper no-js-hidden">
					<small class="products-bundle__error js-product-bundle-error"></small>

					{%- if show_total -%}
						<div class="products-bundle__total js-product-total">
							{{ "sections.bundle.total" | t }} <span class="products-bundle__total-price js-product-total-price"></span>
						</div>
					{%- endif -%}

					<button
						class="button button--{{- button_type }} products-bundle__button js-products-bundle-button"
						data-disabled-label="{{- button_disabled_label -}}"
						data-enabled-label="{{- button_label -}}"
						{% unless all_products_has_only_one_variant %}
							disabled
						{%- endunless -%}
						{% unless all_products_has_available_variant %}
							disabled
						{%- endunless -%}
					>
						{% if all_products_has_only_one_variant %}
							{%- if all_products_has_available_variant -%}
								{{- "products.product.add_to_cart" | t -}}
							{%- else -%}
								{{- "products.product.sold_out" | t -}}
							{%- endif -%}
						{%- else -%}
							{{- button_disabled_label -}}
						{%- endif-%}
					</button>
				</div>
			</div>
		</div>
	</section>
{%- endcapture -%}

{%- if design == "alternate" -%}
	{%- render "products-bundle-new", section: section -%}
{%- else -%}
	{{- old_layout -}}
{%- endif -%}

<script src="{{- 'section-products-bundle.build.min.js' | asset_url -}}" defer></script>

{%- schema -%}
{
	"name": "Products bundle",
	"disabled_on": {
		"groups": ["header", "footer"],
		"templates": ["password"]
	},
	"settings": [
		{
			"type": "text",
			"id": "label",
			"label": "Label"
		},
		{
			"type": "text",
			"id": "heading",
			"label": "Heading",
			"default": "Select and save"
		},
		{
			"type": "richtext",
			"id": "subheading",
			"label": "Subheading",
			"default": "<p>Select 3 products and get 25% discount</p>"
		},
		{
			"type": "product_list",
			"id": "product_list",
			"label": "Products",
			"limit": 3
		},
		{
			"type": "text",
			"id": "button_label",
			"label": "Button label",
			"default": "Add to cart"
		},
		{
			"type": "text",
			"id": "button_disabled_label",
			"label": "Disabled button label",
			"default": "Choose products",
			"info": "If not set “Button label“ will be used"
		},
		{
			"type": "select",
			"id": "button_type",
			"label": "Button type",
			"options": [
				{
					"value": "primary",
					"label": "Primary"
				},
				{
					"value": "secondary",
					"label": "Secondary"
				}
			],
			"default": "secondary",
			"info": "The setting works for the standard design"
		},
		{
			"type": "checkbox",
			"id": "show_total",
			"label": "Show total price",
			"default": true
		},
		{
			"type": "header",
			"content": "Colors"
		},
		{
			"type": "color",
			"id": "border_color",
			"label": "Product card border",
			"default": "#e6e6e6"
		},
		{
			"type": "color",
			"id": "checkbox_color",
			"label": "Checkbox",
			"default": "#000000"
		},
		{
			"type": "header",
			"content": "Layout"
		},
		{
			"type": "checkbox",
			"id": "full_width",
			"label": "Make full width",
			"default": false,
			"info": "If unchecked - container width will be set based on the group 'Layout' settings in the Theme settings."
		},
		{
			"type": "range",
			"id": "offset_top_desktop",
			"min": 0,
			"max": 100,
			"step": 1,
			"unit": "px",
			"label": "Desktop offset top",
			"default": 30
		},
		{
			"type": "range",
			"id": "offset_bottom_desktop",
			"min": 0,
			"max": 100,
			"step": 1,
			"unit": "px",
			"label": "Desktop offset bottom",
			"default": 30
		},
		{
			"type": "range",
			"id": "offset_top_mobile",
			"min": 0,
			"max": 100,
			"step": 1,
			"unit": "px",
			"label": "Mobile offset top",
			"default": 30
		},
		{
			"type": "range",
			"id": "offset_bottom_mobile",
			"min": 0,
			"max": 100,
			"step": 1,
			"unit": "px",
			"label": "Mobile offset bottom",
			"default": 30
		}
	],
	"presets": [
		{
			"name": "Products bundle"
		}
	]
}
{%- endschema -%}
