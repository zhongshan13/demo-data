{%- comment -%}
------------------------------------------------------------------------------
	Section: Order template
------------------------------------------------------------------------------
{%- endcomment -%}

{{- "account-entrance.build.css" | asset_url | stylesheet_tag -}}

{%- style -%}
	#shopify-section-{{- section.id -}} {
		padding-top: {{- section.settings.offset_top_mobile -}}px;
		padding-bottom: {{- section.settings.offset_bottom_mobile -}}px;
	}

	@media screen and (min-width: 768px) {
		#shopify-section-{{- section.id -}} {
			padding-top: {{- section.settings.offset_top_desktop -}}px;
			padding-bottom: {{- section.settings.offset_bottom_desktop -}}px;
		}
	}
{%- endstyle -%}

{%- assign show_unit_price = settings.is_show_unit_price -%}

<section class="account-entrance">
	<div class="account-entrance__container account-entrance__container--large">
		<div class="account-entrance__header">
			<h1 class="account-entrance__heading">
				{{ 'customer.account.title' | t }}
			</h1>


			<a class="account-entrance__link" href="{{ routes.account_url }}">
				{{ 'customer.account.return' | t }}
			</a>
		</div>

		<div class="account-entrance__row">
			<h2 class="account-entrance__order-title">{{ 'customer.order.title' | t: name: order.name }}</h2>

			{%- assign order_date = order.created_at | date: "%B %d, %Y %I:%M%p" -%}
			<p class="account-entrance__order-date">{{ 'customer.order.date' | t: date: order_date }}</p>
		</div>

		{%- if order.cancelled -%}
			<div class="order--cancelled">
				{%- assign cancelled_at = order.cancelled_at | date: "%B %d, %Y %I:%M%p" -%}
				<p>{{ 'customer.order.cancelled' | t: date: cancelled_at }}</p>
				<p>{{ 'customer.order.cancelled_reason' | t: reason: order.cancel_reason }}</p>
			</div>
		{%- endif -%}

		<table class="responsive-table">
			<thead>
				<tr>
					<th class="column-large">{{ 'customer.order.product' | t }}</th>
					<th>{{ 'customer.order.sku' | t }}</th>
					<th>{{ 'customer.order.price' | t }}</th>
					<th>{{ 'customer.order.quantity' | t }}</th>
					<th>{{ 'customer.order.total' | t }}</th>
				</tr>
			</thead>

			<tbody>
				{%- for line_item in order.line_items -%}
					<tr id="{{ line_item.key }}" class="responsive-table__row">
						<td class="column-large" data-label="{{ 'customer.order.product' | t }}">
							<a href="{{- line_item.product.url -}}" class="focus-visible-outline">
								{{- line_item.title -}}
							</a>

							{%- assign property_size = line_item.properties | size -%}

							{%- unless line_item.selling_plan_allocation == nil and property_size == 0 -%}
								<ul class="account-entrance__order-detail-properties">
									{%- unless line_item.selling_plan_allocation == nil -%}
										<li>
											{{- line_item.selling_plan_allocation.selling_plan.name -}}
										</li>
									{%- endunless -%}

									{%- if property_size != 0 -%}
										{%- for property in line_item.properties -%}
											{% assign property_first_char = property.first | slice: 0 %}

											{%- if property.last != blank and property_first_char != '_' -%}
												<li>
													{{- property.first -}}:&nbsp;

													{%- if property.last contains '/uploads/' -%}
														<a href="{{ property.last }}">{{ property.last | split: '/' | last }}</a>
													{%- else -%}
														{{- property.last -}}
													{%- endif -%}
												</li>
											{%- endif -%}
										{%- endfor -%}
									{%- endif -%}
								</ul>
							{%- endunless -%}

							{%- if line_item.line_level_discount_allocations != blank -%}
								<ul class="account-entrance__discount-list" role="list" aria-label="{{ 'customer.order.discount' | t | escape }}">
									{%- for discount_allocation in line_item.line_level_discount_allocations -%}
										<li class="account-entrance__discount-list-item">
											{% render 'icons-small', icon: 'discount' %} {{- discount_allocation.discount_application.title }} (-{{ discount_allocation.amount | money -}})
										</li>
									{%- endfor -%}
								</ul>
							{%- endif -%}

							{%- if line_item.fulfillment -%}
								<div class="account-entrance__order-detail-note note">
									{%- assign created_at = line_item.fulfillment.created_at | date: format: 'month_day_year' -%}

									{{ 'customer.order.fulfilled_at' | t: date: created_at }}

									<div>
										{% if line_item.fulfillment.tracking_url %}
											<a href="{{ line_item.fulfillment.tracking_url }}">
												{{ 'customer.order.track_shipment' | t }}
											</a>
										{% endif %}

										<div>
											{{ line_item.fulfillment.tracking_company }}
											{% if line_item.fulfillment.tracking_number %} #{{ line_item.fulfillment.tracking_number }} {% endif %}
										</div>
									</div>
								</div>
							{%- endif -%}
						</td>

						<td data-label="{{ 'customer.order.sku' | t }}">{{ line_item.sku }}</td>

						<td data-label="{{ 'customer.order.price' | t }}">
							{%- if line_item.original_price != line_item.final_price or line_item.unit_price_measurement -%}
								<dl>
									{%- if line_item.original_price != line_item.final_price -%}
										<dt>
											<span class="visually-hidden">{{ 'products.product.price.regular_price' | t }}</span>
										</dt>
										<dd class="regular-price">
											<s>{{ line_item.original_price | money }}</s>
										</dd>
										<dt>
											<span class="visually-hidden">{{ 'products.product.price.sale_price' | t }}</span>
										</dt>
										<dd>
											<span>{{ line_item.final_price | money }}</span>
										</dd>
									{%- else -%}
										<dt>
											<span class="visually-hidden">{{ 'products.product.price.regular_price' | t }}</span>
										</dt>
										<dd>
											{{ line_item.original_price | money }}
										</dd>
									{%- endif -%}
									{% if line_item.unit_price_measurement %}
										<dt>
											<span class="visually-hidden">{{ 'products.product.price.unit_price' | t }}</span>
										</dt>
										<dd>
											<small>
												{{ line_item.unit_price | money }}

												<span aria-hidden="true">/</span>

												{%- if line_item.unit_price_measurement.reference_value != 1 -%}
													{{- line_item.unit_price_measurement.reference_value -}}
												{%- endif -%}

												{{ line_item.unit_price_measurement.reference_unit }}
											</small>
										</dd>
									{% endif %}
								</dl>
							{%- else -%}
								<span>{{ line_item.final_price | money }}</span>
							{%- endif -%}
						</td>

						<td data-label="{{ 'customer.order.quantity' | t }}">{{ line_item.quantity }}</td>
						<td data-label="{{ 'customer.order.total' | t }}">
							{%- if line_item.original_line_price != line_item.final_line_price -%}
								<dl>
									<dt>
										<span class="visually-hidden">{{ 'products.product.price.regular_price' | t }}</span>
									</dt>
									<dd class="regular-price">
										<s>{{ line_item.original_line_price | money }}</s>
									</dd>
									<dt>
										<span class="visually-hidden">{{ 'products.product.price.sale_price' | t }}</span>
									</dt>
									<dd>
										<span>{{ line_item.final_line_price | money }}</span>
									</dd>
								</dl>
							{%- else -%}
								{{ line_item.original_line_price | money }}
							{%- endif -%}
						</td>
					</tr>
				{%- endfor -%}
			</tbody>

			<tfoot>
			<tr class="responsive-table__row">
				<td colspan="4" class="responsive-table__small-hide">{{ 'customer.order.subtotal' | t }}</td>
				<td data-label="{{ 'customer.order.subtotal' | t }}">{{ order.line_items_subtotal_price | money }}</td>
			</tr>

			{% for discount_application in order.cart_level_discount_applications %}
				<tr class="order_summary discount">
					<td colspan="4" class="responsive-table__small-hide">{{ 'customer.order.discount' | t }}</td>
					<td data-label="{{ 'customer.order.discount' | t }}">
						-{{ discount_application.total_allocated_amount | money }}

						{% if discount_application.title != blank %}
							<span class="account-entrance__order-summary-discount">{% render 'icons-small', icon: 'discount' %} {{ discount_application.title }}</span>
						{% endif %}
					</td>
				</tr>
			{% endfor %}

			{%- for shipping_method in order.shipping_methods -%}
				<tr>
					<td colspan="4" class="responsive-table__small-hide">{{ 'customer.order.shipping' | t }} ({{ shipping_method.title }})</td>
					<td data-label="{{ 'customer.order.shipping' | t }} ({{ shipping_method.title }})">{{ shipping_method.price | money }}</td>
				</tr>
			{%- endfor -%}

			{%- for tax_line in order.tax_lines -%}
				<tr>
					<td colspan="4" class="responsive-table__small-hide">{{ 'customer.order.tax' | t }} ({{ tax_line.title }} {{ tax_line.rate | times: 100 }}%)</td>
					<td data-label="{{ 'customer.order.tax' | t }} ({{ tax_line.title }} {{ tax_line.rate | times: 100 }}%)">{{ tax_line.price | money }}</td>
				</tr>
			{%- endfor -%}

			<tr>
				<td colspan="4" class="responsive-table__small-hide"><strong>{{ 'customer.order.total' | t }}</strong></td>
				<td data-label="{{ 'customer.order.total' | t }}"><strong>{{ order.total_net_amount | money }} {{ order.currency }}</strong></td>
			</tr>
			</tfoot>
		</table>

		<div class="account-entrance__row account-entrance__row--billings">

			<div class="account-entrance__billings">
				<h3>{{ 'customer.order.billing_address' | t }}</h3>

				<p><strong>{{ 'customer.order.payment_status' | t }}:</strong> {{ order.financial_status_label }}</p>

				{{ order.billing_address | format_address }}
			</div>

			<div class="account-entrance__billings">
				<h3>{{ 'customer.order.shipping_address' | t }}</h3>

				<p><strong>{{ 'customer.order.fulfillment_status' | t }}:</strong> {{ order.fulfillment_status_label }}</p>

				{{ order.shipping_address | format_address }}
			</div>
		</div>

	</div>
</section>

{% schema %}
{
	"name": "Order template",
	"settings": [
		{
			"type": "header",
			"content": "Layout"
		},
		{
			"type": "range",
			"id": "offset_top_desktop",
			"min": 0,
			"max": 100,
			"step": 1,
			"unit": "px",
			"label": "Desktop offset top",
			"default": 60
		},
		{
			"type": "range",
			"id": "offset_bottom_desktop",
			"min": 0,
			"max": 100,
			"step": 1,
			"unit": "px",
			"label": "Desktop offset bottom",
			"default": 60
		},
		{
			"type": "range",
			"id": "offset_top_mobile",
			"min": 0,
			"max": 100,
			"step": 1,
			"unit": "px",
			"label": "Mobile offset top",
			"default": 30
		},
		{
			"type": "range",
			"id": "offset_bottom_mobile",
			"min": 0,
			"max": 100,
			"step": 1,
			"unit": "px",
			"label": "Mobile offset bottom",
			"default": 30
		}
	]
}
{%- endschema -%}
